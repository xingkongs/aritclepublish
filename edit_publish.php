<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>大牛说 投稿</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="{$daniusaynew_staticDir}external/css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">-->
    <link rel="stylesheet" href="{$daniusaynew_staticDir}external/css/cropper.min.css">


    <link rel="stylesheet" href="{$daniusaynew_staticDir}external/css/wangEditor.min.css">
    <link rel="stylesheet" type="text/css" href="{$daniusaynew_staticDir}external/css/webuploader.css">
    <link rel="stylesheet" type="text/css" href="{$daniusaynew_staticDir}css/uploadpic2.css">
    <link rel="stylesheet" href="{$daniusaynew_staticDir}css/style.css">
    <link rel="stylesheet" href="{$daniusaynew_staticDir}icons/iconfont.css">
    <link rel="stylesheet" href="{$daniusaynew_staticDir}external/js/perfect-scrollbar.min.css">
    <link href="{$daniusaynew_staticDir}external/css/prettify.css" rel="stylesheet">
	<link href="http://at.alicdn.com/t/font_1468891910_6327245.css" rel="stylesheet">
	<link rel="stylesheet" href="{$daniusaynew_staticDir}css/main.css">
	
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--[if lt IE 9]>
    <script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
    <script src="http://cdn.amazeui.org/amazeui/2.7.0/js/amazeui.ie8polyfill.min.js"></script>
    <![endif]-->
	
    <!--[if (gte IE 9)|!(IE)]><!-->
    <script src="{$daniusaynew_staticDir}external/js/jquery-1.10.2.min.js"></script>
    <!--<![endif]-->
	<!--[if lte IE 9 ]>

		 <style>
			 .roww{overflow:hidden;}
			 .blog-main{width:716px;float:left;margin-right:20px;}
			 .blog-sidebar{width:260px;float:left;}
			
		 </style>
	<![endif]-->
	<!--[if IE]>
		<style>
			:-ms-input-placeholder {color: red; }
			#file{filter:alpha(opacity=0);font-size:100px;position:absolute;top:-20px;left:-1100px;}
					
		</style>
	<![endif]-->
		

	 <!--[if IE 8]>
		<style>
		.webuploader-pick{z-index:2;}
		#head{height:80.35px;padding:30px 10px;}	
		</style>
	 <![endif]-->


</head>
<body onload="document.getElementById('head').focus()">
<!-- Fixed navbar -->
<!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container container--head">
        <div class="navbar-header" style="width:161.69px;">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand--re" href="http://www.d1ev.com/"><img src="{$daniusaynew_staticDir}images/top_logo.png" alt=""></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">			
                <li class="dropdown open">
                    <a href="#" class="dropdown-toggle dropdown--re" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true">使用帮助 <span class="glyphicon glyphicon-menu-down" style="font-size:12px"></span></a>
                    <ul class="dropdown-menu dropdown-menu--re">
                   <li>
						<p style="color:#4c4c4c;font-size:16px;">关于投稿</p>
						<p>1、欢迎与新能源汽车行业、话题、公司有关的稿件，购买、 使用新能源汽车的稿件、内容题材不限，言之有物，语言通顺 </p>
						<p>2、每月对优秀稿件给予稿费激励</p>
						<p>3、欢迎首发和原创，谢绝转载</p>
						<p>4、文中有关键事实、数据、图表等是引用其他媒体或作者的内容，请注明来源</p>
						<p>5、软文、枪文，敬请绕道，抄袭盗稿零容忍，一经发现立即封号，并由作者本人承担法律责任</p>
						<br>
						<p style="color:#4c4c4c;font-size:16px;">关于编辑器的使用</p>
						<p>1、请勿使用外链图片，正文插图请本地上传</p>
						<p>2、支持5M以内图片上传，如图片太大，请压缩后再上传</p>
						<p>3、支持多图上传（部分IE浏览器不可用）</p> 
						<br>
						<p>投稿过程中遇到操作问题，请联系：yxh@d1ev.com, nanmeng@d1ev.com</p>
					</li>
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
				<li id="prompt" style="width: 336px;margin-right:10px;line-height: 26px;text-align: center;color:#808080;z-index:10000;position:relative;top:-11px;">
					<div class="alert-danger alert  alert-dismissible" role="alert" >
					  					   
					</div>
				</li>
                <li id="savetxt" class="bg-warning"><a href="javascript:;">保存草稿</a></li>
                <li class="dropdown--hover"><a href="javascript:;" id="preview">预览</a></li>
                <li class="dropdown--article dropdown--hover"><a href="javascript:;" id="dropdownMenu1">提交审核 <span class="glyphicon glyphicon-menu-down" style="font-size:12px"></span></a>
					<ul class="dropdown-menu dropdown-menu--join" style="display:none;width: 410px; padding-bottom: 0px; top: 39px; border: none; box-shadow: rgba(0, 0, 0, 0.172549) 0px 0px 12px;">
						<li class="am-dropdown-header"><span>本月有征文比赛，您可以参与。</span></li>
						<li><span class="radio"><label>  <input type="radio" name="article" value="征文 | 大牛“百人会” 问政新能源" aria-label="...">征文 | 大牛“百人会” 问政新能源</label></span></li>						
						<li><span class="radio"><label>  <input type="radio" name="article" value="征文 | 如何应对地方补贴取消或退坡？" aria-label="...">征文 | 如何应对地方补贴取消或退坡？</label></span></li>
						<li><span class="radio"><label>  <input type="radio" name="article" value="征文 | 谁说电动汽车不能远行？" aria-label="...">征文 | 谁说电动汽车不能远行？</label></span></li>
						<li><span class="radio"><label>  <input type="radio" name="article" value="不参加" aria-label="...">不参加</label></span></li>
						<li class="input--hover"><input type="submit" value="确定" style="width:100%; text-align: center;color:#5c5c5c;border:none;padding: 15px 0;font-size:16px;background: #fff;border-top:1px solid rgba(221, 221, 221, 0.21);" onclick="send('http://www.d1ev.com/member/articlenew/add.html',0)"></li>
					</ul>
                </li>
					
                <li class="dropdown dropdown--txt"><a href="#" class="dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" ><i class="icon iconfont">&#xe60d;</i></a>
                    <ul class="dropdown-menu dropdown-menu--text" aria-labelledby="dropdownMenu1" style="margin-top:-1px">

                        <li><a href="http://www.d1ev.com/member/article/index.html">我的投稿</a></li>
                        <li><a href="http://www.d1ev.com/member/article/caogao.html">我的草稿</a></li>

                    </ul>

                </li>

            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class="wrapped">


    <div class="row--re">

        <div class="blog blog-main">
		

            <form class="am-form" style="box-shadow: 0 0 4px #F1F1F1;position:relative;">

                <input id="head" type="text" value="{$daniusay.title}" placeholder="请在这里输入标题，5-30个字" onchange="autosave(true);" maxlength='30'>
				<span></span>
                <div>
                    <!--用当前元素来控制高度-->
                    <div id="div1" style="height:496px;max-height:20000px;color:#333;font-size:16px;">{$daniusay.content}</div>
                </div>
            </form>

        </div><!-- /.blog-main -->
        <div class="blog-middle"></div>
        <div class="blog blog-sidebar">
            <div class="sidebar-module sidebar-module-inset">
                <div class="container--re" id="crop-avatar">

                    <!-- Current avatar -->
                    <div class="avatar-view">
                        <img data-aid="14332" src="{$daniusay['thumb']}" alt="请上传图片">
                        <p>上传封面，支持高清图片</p>
                    </div>

                    <!-- Cropping modal -->
                    <div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <form class="avatar-form" action="http://www.d1ev.com/Attachment/attachments/frontCover.html" enctype="multipart/form-data" method="post">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title" id="avatar-modal-label">改变封面图片</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="avatar-body">

                                            <!-- Upload image and data -->
                                            <div class="avatar-upload">
                                                <input type="hidden" class="avatar-src" name="avatar_src">
                                                <input type="hidden" class="avatar-data" name="avatar_data">
                                                <label for="avatarInput">本地上传:</label>
                                                <input type="file" class="avatar-input" id="avatarInput" name="avatar_file">
                                            </div>

                                            <!-- Crop and preview -->
                                            <div class="row">
                                                <div class="col-md-9">
                                                    <div class="avatar-wrapper"></div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="avatar-preview preview-lg"></div>
                                                    <div class="avatar-preview preview-md"></div>
                                                    <div class="avatar-preview preview-sm"></div>
                                                </div>
                                            </div>

                                            <div class="row avatar-btns">
                                                <div class="col-md-9">
                                                    <div class="btn-group">
                                                        <button type="button" class="btn btn-default" data-method="rotate" data-option="-90" title="Rotate -90 degrees">
															<span class="glyphicon glyphicon-repeat" style="transform: scaleX(-1);"></span>
														</button>

                                                    </div>
                                                    <div class="btn-group">
													<button type="button" class="btn btn-default" data-method="rotate" data-option="-90" title="Rotate -90 degrees">
														<span class="glyphicon glyphicon-repeat"></span>
													</button>

                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <button type="submit" style="" class="btn btn-primary btn-block avatar-save bg-warning">上传</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- <div class="modal-footer">
                                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    </div> -->
                                </form>
                            </div>
                        </div>
                    </div><!-- /.modal -->

                    <!-- Loading state -->
                    <div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>
                </div>
            </div>
            <div class="sidebar-module" id="articlePicGroup" >
                <div class="about">
                    <div class="am-g am-container">
                        <div class="am-u-lg-12">

                            <div class="am-g">
                                
								<div id="uploader" class="wu-example--re" style="min-height:380px;">
                                    <div id="upload">
                                        <div id="filePicker" class="webuploader-container"><div class="webuploader-pick"><span class="iconfont icon-fill108"></span> 上传图片</div><div id="rt_rt_1anmbslba177a1pb1qu411i7106n1" style="position: absolute; top: 0px; left: 11.1563px; width: 240px; height: 46px; overflow: hidden; bottom: auto; right: auto;"><input id="file" type="file" name="file" style="padding:10px;opacity: 0;cursor: pointer;" multiple="multiple" accept="image/*" title="上传图片"><label style="opacity: 0; width: 100%; height: 100%; display: block; cursor: pointer; background: rgb(255, 255, 255);"></label></div></div>
                                        <!--<input type="file" id="file" multiple="multiple" accept="image/gif, image/jpeg, image/x-png">-->
                                        <div class="statusBar" style="display: block!important;">
                                            <div class="progress" style="display:none;">
                                                <div id="progress-wrap" class="progress-bar progress-bar-info  progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;line-height:12px;">
                                                    0%
                                                </div>
                                            </div>
                                        </div>

                                        <ul id="wrapper" class="filelist">
											<volist name="imglist" id="vo">
												<li class="img-item"><p class="title">file</p><p class="imgWrap"><img src="{$vo.url}" data-aid="{$vo.aid}"></p><div class="file-panel" style="height: 0px;"><span class="cancel">删除</span></div></li>
											</volist>
										</ul>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
				<div id="ppreview"><img src="" alt=""></div>
            </div>

        </div><!-- /.blog-sidebar -->

    </div><!-- /.row -->

</div><!-- /.container -->


<div class="alert alert-default alert--position" role="alert" style="display:none;">
    你有未完成的草稿，
    <a href="javascript:;" class="alert-link load">载入</a> <a href="javascript:;" class="alert-link getup">放弃</a>
</div>
<div id="daniu-id" style="display:none;">{$daniusay.id}</div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script type="text/javascript">
    // 添加全局站点信息
    var BASE_URL = '/webuploader';
	var n=0;
	var timea;
	var first=0;
	var getmsg;
	var dataa;
	var datae;
         //模拟alert
		    function alertContent(data) {
				$(".alert-danger").find("p").remove();
				if($(".alert-danger").closest("#prompt").css("display")==="none"){
					$(".alert-danger").closest("#prompt").fadeIn();
				}		
				
				$(".alert-danger").append("<p>"+data+"</p>")
				
				
				var timex=setTimeout(function s(){
					
					$(".alert-danger").closest("#prompt").fadeOut();
					
					
				},3000);
				

			}

		// 上传图片列表 滚动条初始化
	window.onload = function () {
		Ps.initialize(document.querySelector('#wrapper'));
	};	
	//30s倒计时
    function timeauto(){
        window.clearTimeout(timea);
        n=0;
        timea=window.setTimeout(function stepa(){
            n++;
            //console.log(n);
            if(n===15){
                initcontent=true;
                console.log(initcontent);
				autosave(initcontent);
                return window.clearTimeout(timea);

            }
            timea=setTimeout(stepa,1000);
        },1000);

    }
</script>
<script src="{$daniusaynew_staticDir}external/js/wangEditor.js"></script>
<script src="{$daniusaynew_staticDir}js/plugin.js"></script>
<script type="text/javascript">
    var initcontent=false;
    var editor = new wangEditor('div1');
   
	editor.config.menus = [
        'bold',
        'italic',
        'pindent',
        'forecolor',
        '|',     // '|' 是菜单组的分割线
        'alignleft',
        'aligncenter',
        'alignright',
        '|',
        'quote',
        'unorderlist',
        'orderlist',
        '|',
        'link',
        'video',
		'|',
		'eraser'
    ];
	    // 颜色
    editor.config.colors = {
        '#800080': '紫色',
        '#ff0000': '红色',
		'#ff00ff': '鲜粉色',
		'#000080': '深蓝色',
		'#0000ff': '蓝色',
		'#00ffff': '湖蓝色',
		'#008080': '蓝绿色',
		'#008000': '绿色',
		'#808000': '橄榄色',
		'#00ff00': '浅绿色',
		'#ffcc00': '橙黄色',
		'#808080': '灰色',
		'#c0c0c0': '银色',
		'#333':'默认黑',
    };

//        editor.UI.menus.forecolor = {
//            // normal 配置正常状态下显示的UI
//            normal: '<a><span class="glyphicon glyphicon-font" aria-hidden="true"></span></a>',
//            // selected 配置选中状态下的UI，.selected 说明菜单在选中状态下要增加一个 selected class
//            selected: '.selected'
//        };

//        editor.config.menuFixed =false;

    
    // 配置 onchange 事件
    editor.onchange = function () {
        // 编辑区域内容变化时，实时打印出当前内容
        timeauto();
        
    };

    //console.log(editorChange);
    $("#head").on('input propertychange', function() {
        //标题内容变化
		timeauto();
		//autosave(initcontent);
		var i=$("#head").val().length;
		if(i){$("#inputnum").text(i+"/30");
		$(this).css("padding-right","60px")
		} else {
			$("#inputnum").text("")
		}
		
		window.onbeforeunload = function(event) {
    
        event.returnValue="已自动保存"+datae+"时的内容";
    }
    })
    editor.create();
	
  //监听滚动 编辑器吸顶	
    $(".menu-group").eq(0).closest(".wangEditor-menu-container").addClass("parent").css("width","100%;");

    $(window).on('scroll', function(){
//            console.log($(window).scrollTop());
        if($(window).scrollTop()>100){
            $(".parent").css("position","fixed").css("top","72px").css("width","716px");
//                $(".wangEditor-drop-panel").css("position","fixed");
            //$(".wangEditor-container").addClass("margin--re").css("top","50px")
        }else{
            $(".parent").css("position","relative").css("top","0px");;
            $(".wangEditor-drop-panel").css("position","relative");
            //$(".wangEditor-container").removeClass("margin--re").css("top","0")

        }



    })
	
</script>

<script>

	//悬浮于封面 显示提示文字
    $(".avatar-view").hover(function(){
        $(this).find("p").stop().slideToggle(300)
    })
//	 $("button.avatar-save").click(function(){
//			$(this).closest(".container--re").find(".avatar-view img").css("display","block")
//		})
	//悬浮 图片上 显示删除icon
    $("#wrapper").on("mouseenter","li",function(e){
        var href=$(this).find("img").attr("src");
        $lis=$(this)
        $btn=$lis.find(".file-panel")
        $btn.stop().animate({height: 30});
		var xOffset = 30;
		var yOffset = 30;
		$("#ppreview").css("top","0").css("right","270px").fadeIn("fast").find("img").attr("src",href);
		console.log(e);
		
    })

    $("#wrapper").on("mouseleave","li",function(){

        $lis=$(this)
        $btn=$lis.find(".file-panel")
        $btn.stop().animate({height: 0});
		$("#ppreview").css("display","none");
		

    })
	//点击删除icon 删除图片
	$("#upload").on("click","li .file-panel span",function(){
		$(this).closest("li").remove();
	})
	//点击上传按钮 弹出提示框
	$(function() {
	  $('#filePicker').popover({
		content: '上传正文插图，支持5M以内图片，支持多图上传（非IE浏览器）',
		trigger:'hover focus',
		placement:'top'
	  })
	});


</script>
<!-- Include all compiled plugins (below), or include individual files as needed -->


<script src="{$daniusaynew_staticDir}external/js/cropper.min.js"></script>
<script src="{$daniusaynew_staticDir}external/js/bootstrap.min.js"></script>

<script src="{$daniusaynew_staticDir}external/js/perfect-scrollbar.min.js"></script>
<script src="{$daniusaynew_staticDir}external/js/prettify.js"></script>

<script src="{$daniusaynew_staticDir}js/main.js"></script>

<!--[if !IE]><!-->
<script type="text/javascript" src="{$daniusaynew_staticDir}/js/ajaxfileupload.js"></script>
<!--<![endif]-->

<!--[if lte IE 9]>
<script src="{$daniusaynew_staticDir}external/js/form.js"></script>
<script>
	$(function () {
            $('#file').change(function () {
				
            var options = {
                url: '/attachment/attachments/imgUp.html',
                type: 'post',
                dataType: 'text',
				progress: function(event){
					progress(event)
				},
                success: function (data) {
                    if (data.length > 0)
						console.log(data)
                        uploadSuccess(data)
                }
				
            };
            $("#formFile").ajaxSubmit(options)
            
        
            
            });
        })
			
        function uploadSuccess(res) {
			
               res = eval('(' + res + ')');
			   
            if(res.error == 0) {
				var $img=$("<img src="+ res['url'] +" data-aid="+ res['aid'] +">")
                var $li = $( '<li class="img-item">' +
                '<p class="imgWrap"></p>'+
                
                '</li>' ),
				$btns = $('<div class="file-panel">' + '<span class="cancel">删除</span>').appendTo( $li )
				$img.appendTo($li.find( 'p.imgWrap' ))
                $li.appendTo($("#wrapper"));
				console.log($("#wrapper"))
            }
        }
		    var progress = function(event) {
            var loaded = event.loaded;                  //已经上传大小情况 
            var tot = event.total;                      //附件总大小 
            var per = Math.floor(100*loaded/tot);     //百分比
			$("#progress-wrap").closest(".progress").css("display","block")
            $("#progress-wrap").css("width",per+"%").text( per +"%" );
            //$("#progress-wrap").css("width" , per +"%");
			var num=$("#progress-wrap").text();
            setTimeout(function () {
                if (per === 100) {
                    $("#progress-wrap").closest(".progress").css("display", "none")
                }
            }, 1500);
			
			
			
        }
</script>
<![endif]-->

<script src="{$daniusaynew_staticDir}js/global.js"></script>
<script src="{$daniusaynew_staticDir}js/preview.js"></script>
<script>
	// 上传图片 滚动监听
        if ($("#articlePicGroup").length > 0) {
            var a = $("#articlePicGroup")
                    , b = a.offset().top - 90;

            checkShow()

        }

		
        function checkShow(){
            $(window).scroll(function(){
                $("body").css("margin-top","0")
                if ($(window).scrollTop() > b) {
                    var c = $(window).scrollTop() - b + "px";


                    a.stop().css({
                        top: c
                    })
                } else
                    a.stop().css({
                        top: 0
                    })
            })
        }
    //点击图片 添加到编辑器
    var content=undefined;

    var callback=function(content){
        //editor.$txt.append(content)
		editor.command(event, 'insertHtml', content);
    }
    !(function(content, Callback,sm){
        $("#wrapper").on("click","img",function(e){
            var img = e.target;
			$(this).toggleClass("selected")
            var src=$(this).attr("src")
            var $content='<img src="' + src + '" style="max-width:100%;"/>'

            content=$content
            Callback(content);
			
			

        })

    }(content,callback,editor.command));
	//须知点击不消失
	$(".dropdown-menu--re").click(function(){

	 return false
	})
	//点击 弹窗不消失 点击document 弹窗消失
  
        $(function(){   
           
            $(".dropdown-menu--join,.dropdown--article").click(function(e){   
                //console.log(e)
                e?e.stopPropagation():event.cancelBubble = true;   
            });   
                   
            $(".dropdown--article").click(function() {    
            $(".dropdown-menu--join").show();    
               
            }); 
			$(".dropdown--article .input--hover").click(function() {    
				$(".dropdown-menu--join").hide();    
               
            });			
            $(document).click(function() {    
                $(".dropdown-menu--join").hide();    
                   
            });    
        })  

</script>

<script>
	var num

    var __GLBAL__ARTICLE_ID__ = 1;
    function send(address, type){
		
        num=1;
        var obj={}
        obj.thumb = {}
        obj.imglist=[]
        obj.title=$("#head").val();
        obj.content=$("#div1").html();
		obj.article=$("input[name=article]:checked").attr("value");
		obj.idid=$("#daniu-id").text();
        var $img=$("#wrapper").find("li").find("img")
        $img.each(function(e){
            var contents={}
            contents.url=$($img[e]).attr("src");
            contents.aid=$($img[e]).attr("data-aid");
            obj.imglist.push(contents);
			//console.log($img)
			
        });
		
        var tittle={}
        tittle.url=$("#crop-avatar").find("img").attr("src")
        tittle.aid=$("#crop-avatar").find("img").attr("data-aid")
        obj.thumb = tittle
		obj.submitType = '2';
		
        if(__GLBAL__ARTICLE_ID__!=undefined) {
            obj.id = __GLBAL__ARTICLE_ID__;
        }
		if(type===0){obj.submitType = '0';}		//console.log(obj)
        $.ajax({
            type: "POST",
            url: address,
            data: obj
        }).done(function(msg) {
			
            msg = eval('('+ msg +')');
			
            if(type == 2)return;
            if(type == 3){
				if(obj.title&&obj.content.length>12){
					window.open('/member/articlenew/preview.html');return;
				} else{
					alertContent("请先输入标题和正文再预览")
					return;
				}
                
                
            }
			
            if(msg.state == 500) {
                alertContent(msg.message);
            }else {
                __GLBAL__ARTICLE_ID__ = msg.id;
                alertContent(msg.message);
            }
			if(type == 0&&msg.state == 200){
                window.open('http://www.d1ev.com/member/article/shenghe.html');
                
            }

        });
        
    }

    $("#savetxt").on("click",function(){
		var address="http://www.d1ev.com/member/articlenew/edit.html";
       
		     window.onbeforeunload = function(event) {
    
			return;
		}
		
        send(address,1)

    })
	 function autosave(e){
       var address2="http://www.d1ev.com/member/articlenew/edit.html?ajax=1"

       var time
       num=2;
	   dataa=new Date();
	   datae=dataa.toLocaleString();
	   
	   if(($("#head").val().length>0||editor.$txt.html()!=="<p><br></p>")&&(e)){
		   send(address2,2)
	   }
    
   }
	autosave(true)
	$('#preview').click(function() {
		send("http://www.d1ev.com/member/articlenew/add.html?ajax=1",3);
	})
	function getdata(getmsg){
		//console.log(getmsg)
		$("#head").val(getmsg.title);
		$("#div1").html(getmsg.content);
		if(!(getmsg.thumb==="")){
			$("#crop-avatar").find("img").attr("data-aid",getmsg.thumb_aid).attr("src",getmsg.thumb).css("display","block")
		}
		
		
		for( var i in getmsg.imglist){
		  addimglist(getmsg.imglist[i])

		}
		
	}
	$(".alert-default").on("click",".load",function(){
					getdata(getmsg)
					$(".alert-default").fadeOut()
				})
	$(".alert-default").on("click",".getup",function(){
		$.ajax({
            type: "GET",
            url: "http://www.d1ev.com/member/articlenew/issave/give/1.htm" ,
            
        })
		$(".alert-default").fadeOut()
	})
    function addimglist(res){

        var $img=$("<img src="+ res['url'] +" data-aid="+ res['aid'] +">")
        var $li = $( '<li class="img-item">' +

                        '<p class="imgWrap"></p>'+

                        '</li>' ),
                $btns = $('<div class="file-panel">' + '<span class="cancel">删除</span>').appendTo( $li )
        $img.appendTo($li.find( 'p.imgWrap' ))
        $li.appendTo($("#wrapper"));

    }
//离开提醒

   
    window.onbeforeunload = function(event) {
    
        event.returnValue="已自动保存"+datae+"时的内容";
    }


</script>
<script>

 if($(".avatar-view").find("img").attr("src").length){$(".avatar-view").find("img").css("display","block")}

</script>
</body>
</html>